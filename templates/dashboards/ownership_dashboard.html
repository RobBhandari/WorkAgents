{% extends "dashboards/base_dashboard.html" %}

{% block title %}Ownership Dashboard{% endblock %}
{% block meta_description %}Work assignment and distribution metrics - Director Observatory{% endblock %}

{% block header_title %}Ownership Dashboard{% endblock %}
{% block header_subtitle %}Work Assignment & Distribution{% endblock %}
{% block header_metadata %}Week {{ week_number }} â€¢ {{ week_date }} â€¢ Generated {{ generation_date }}{% endblock %}
{% block footer_context %}Ownership Dashboard{% endblock %}

{% block extra_css %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODERN MINIMALIST - Refined Dashboard Styling
   Design Direction: Clean, Refined, Professional
   Inspiration: Stripe, Linear, Modern SaaS dashboards
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

:root {
    --color-slate-50: #f8fafc;
    --color-slate-100: #f1f5f9;
    --color-slate-200: #e2e8f0;
    --color-slate-300: #cbd5e1;
    --color-slate-400: #94a3b8;
    --color-slate-500: #64748b;
    --color-slate-600: #475569;
    --color-slate-700: #334155;
    --color-slate-800: #1e293b;
    --color-slate-900: #0f172a;

    --color-blue-400: #60a5fa;
    --color-blue-500: #3b82f6;
    --color-blue-600: #2563eb;

    --color-emerald-500: #10b981;
    --color-amber-500: #f59e0b;
    --color-red-500: #ef4444;

    --header-gradient-start: var(--color-slate-900) !important;
    --header-gradient-end: var(--color-slate-900) !important;
}

/* Refined typography - Inter with OpenType features */
body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
    background: var(--color-slate-900) !important;
    color: #ffffff !important;
    font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Sophisticated header */
body .header,
.container .header,
div.header {
    background: var(--color-slate-900) !important;
    border: none !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06) !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    padding: 64px 32px !important;
}

.header h1 {
    font-weight: 600 !important;
    letter-spacing: -0.02em !important;
    color: #ffffff !important;
    text-transform: none !important;
    font-size: 2.5rem !important;
}

.header p,
.header .subtitle {
    color: var(--color-slate-400) !important;
    font-weight: 400 !important;
    text-transform: none !important;
    letter-spacing: 0 !important;
}

/* Summary Cards - Refined with subtle borders */
.summary-card,
.card {
    background: var(--color-slate-900) !important;
    border: 1px solid rgba(255, 255, 255, 0.06) !important;
    border-radius: 8px !important;
    padding: 24px !important;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06) !important;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.summary-card:hover,
.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3), 0 8px 10px -6px rgba(0, 0, 0, 0.3) !important;
    border-color: rgba(59, 130, 246, 0.3) !important;
}

/* Tables - Refined styling */
table {
    border-collapse: collapse !important;
}

th {
    background: var(--color-slate-800) !important;
    color: var(--color-slate-400) !important;
    font-weight: 600 !important;
    font-size: 0.85rem !important;
    text-transform: uppercase !important;
    letter-spacing: 0.05em !important;
    padding: 14px 16px !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06) !important;
}

tbody tr {
    border-bottom: 1px solid rgba(255, 255, 255, 0.06) !important;
    transition: background-color 0.2s ease !important;
}

tbody tr:hover {
    background: rgba(255, 255, 255, 0.02) !important;
}

td {
    padding: 12px 16px !important;
    color: #ffffff !important;
}

/* Status badges - Refined colors */
.status-good { color: var(--color-emerald-500) !important; }
.status-caution { color: var(--color-amber-500) !important; }
.status-action { color: var(--color-red-500) !important; }
.status-inactive { color: var(--color-slate-500) !important; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIGHT THEME SUPPORT - Complete styling for light mode
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

[data-theme="light"] body {
    background: #ffffff !important;
    color: var(--color-slate-900) !important;
}

[data-theme="light"] .header {
    background: #ffffff !important;
    border-bottom-color: var(--color-slate-200) !important;
}

[data-theme="light"] .header h1 {
    color: var(--color-slate-900) !important;
}

[data-theme="light"] .header p,
[data-theme="light"] .header .subtitle {
    color: var(--color-slate-600) !important;
}

[data-theme="light"] .summary-card,
[data-theme="light"] .card {
    background: #ffffff !important;
    border-color: var(--color-slate-200) !important;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px 0 rgba(0, 0, 0, 0.03) !important;
}

[data-theme="light"] .summary-card:hover,
[data-theme="light"] .card:hover {
    border-color: var(--color-blue-400) !important;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05) !important;
}

[data-theme="light"] th {
    background: var(--color-slate-100) !important;
    color: var(--color-slate-700) !important;
    border-bottom-color: var(--color-slate-200) !important;
}

[data-theme="light"] tbody tr {
    border-bottom-color: var(--color-slate-200) !important;
}

[data-theme="light"] tbody tr:hover {
    background: var(--color-slate-50) !important;
}

[data-theme="light"] td {
    color: var(--color-slate-900) !important;
}

/* Footer - Light Mode */
[data-theme="light"] .footer p {
    color: var(--color-slate-600) !important;
}
</style>

{% endblock %}

{% block content %}
<!-- Executive Summary -->
<div class="executive-summary">
    <div class="status-badge">{{ summary_stats.status_text }}</div>
    <h2 style="margin-bottom: 10px;">Executive Summary</h2>
    <p>
        Ownership metrics across {{ summary_stats.project_count }} projects. These metrics show how well work is assigned and distributed across teams.
    </p>

    <div class="summary-grid">
        <div class="summary-card">
            <div class="label">Unassigned Rate</div>
            <div class="value">{{ summary_stats.avg_unassigned_pct|format_percent }}<span class="unit">%</span></div>
            <div class="explanation">Percentage of work without an assigned owner</div>
        </div>

        <div class="summary-card" style="border-left-color: #ef4444;">
            <div class="label">Total Unassigned</div>
            <div class="value">{{ summary_stats.total_unassigned|format_number }}<span class="unit">items</span></div>
            <div class="explanation">Work items that need owners</div>
        </div>

        <div class="summary-card" style="border-left-color: #3b82f6;">
            <div class="label">Unassigned %</div>
            <div class="value">{{ summary_stats.avg_unassigned_pct|format_percent }}<span class="unit">%</span></div>
            <div class="explanation">Average across all projects</div>
        </div>

        <div class="summary-card" style="border-left-color: #10b981;">
            <div class="label">Total Work Items</div>
            <div class="value">{{ summary_stats.total_all_items|format_number }}</div>
            <div class="explanation">All open items analyzed</div>
        </div>
    </div>
</div>

<!-- Project Comparison Table -->
<div class="section">
    <h2>Project Ownership Metrics</h2>
    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Project</th>
                    <th>Total Items</th>
                    <th>Unassigned</th>
                    <th>Unassigned %</th>
                    <th>Assignees</th>
                    <th>Avg Active Days</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
            {% for row in project_rows %}
                <tr class="data-row clickable"
                    onclick="toggleDetail('detail-{{ loop.index }}', this)"
                    title="{{ row.status_tooltip }}">
                    <td>{{ row.project_name }}</td>
                    <td>{{ row.total|format_number }}</td>
                    <td>{{ row.unassigned_count|format_number }}</td>
                    <td>{{ row.unassigned_pct|format_percent }}%</td>
                    <td>{{ row.assignee_count }}</td>
                    <td {% if row.avg_active_days is not none %}title="{{ row.sample_size }} developers tracked over 90 days"{% else %}title="No commit data available"{% endif %}>
                        {% if row.avg_active_days is not none %}
                            {{ "%.1f"|format(row.avg_active_days) }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>{{ row.status_html|safe }}</td>
                </tr>
                <tr id="detail-{{ loop.index }}" class="detail-row">
                    <td colspan="7">
                        <div class="detail-content">
                            {{ row.drilldown_html|safe }}
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Glossary -->
<div class="glossary">
    <div class="glossary-header" onclick="toggleGlossary()">
        <h3>ğŸ“– What These Metrics Mean</h3>
        <span class="glossary-toggle" id="glossary-toggle">â–¼</span>
    </div>
    <div class="glossary-content" id="glossary-content">
        <div class="glossary-item">
            <div class="glossary-term">Unassigned Items</div>
            <div class="glossary-definition">
                Work items without an assigned owner. These are at risk of being forgotten or delayed.
                Every work item should have a clear owner responsible for moving it forward.
                <br><strong>Target:</strong> Keep below 10%
            </div>
        </div>

        <div class="glossary-item">
            <div class="glossary-term">Work Type Status Indicators</div>
            <div class="glossary-definition">
                Each work type card (Bug, User Story, Task) shows a status indicator based on the percentage of unassigned items.
                The border color and background tint show at a glance whether ownership is well-distributed or needs attention.
                <br><br>
                <strong>Status Based on Unassigned Percentage:</strong>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong style="color: #10b981;">âœ“ Good (&lt; 25% unassigned):</strong> Most work has clear ownership - healthy assignment pattern</li>
                    <li><strong style="color: #f59e0b;">âš  Caution (25-50% unassigned):</strong> Significant work lacks ownership - review assignment process and capacity</li>
                    <li><strong style="color: #ef4444;">â— Action Needed (&gt; 50% unassigned):</strong> Majority of work is unassigned - immediate attention needed for capacity planning or triage</li>
                </ul>
                <strong>What to look for:</strong> Green cards indicate healthy ownership. Red cards suggest that work is piling up without owners, which can lead to delayed delivery and unclear accountability.
            </div>
        </div>

        <div class="glossary-item">
            <div class="glossary-term">Area Unassigned Statistics</div>
            <div class="glossary-definition">
                Shows unassigned work percentage by area path with no arbitrary classifications.
                Simply displays which areas have the highest percentage of unassigned work, allowing you to see patterns.
            </div>
        </div>

        <div class="glossary-item">
            <div class="glossary-term">Assignees</div>
            <div class="glossary-definition">
                Number of unique team members with assigned work in a project.
                More assignees suggests broader team engagement.
            </div>
        </div>

        <div class="glossary-item">
            <div class="glossary-term">Avg Active Days</div>
            <div class="glossary-definition">
                The average number of days per developer with commit activity in the last 90 days.
                This measures developer engagement frequency. Calculated by counting the unique days each developer
                made commits, then averaging across all developers in the project.
                <br><br>
                <strong>Example:</strong> If Developer A committed on 20 unique days and Developer B on 10 unique days,
                the average is 15 days. Higher values indicate more consistent developer engagement.
            </div>
        </div>

        <div class="glossary-item">
            <div class="glossary-term">Load Imbalance</div>
            <div class="glossary-definition">
                Ratio of maximum to minimum workload across assignees.
                High ratios (e.g., 5:1) suggest some team members are overloaded while others are underutilized.
            </div>
        </div>

        <div class="glossary-item">
            <div class="glossary-term">Overall Status</div>
            <div class="glossary-definition">
                Status is based on unassigned work percentage.
                <br><br>
                <strong>Status Categories:</strong>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong style="color: #10b981;">âœ“ Low Unassigned:</strong> Less than 25% of work unassigned</li>
                    <li><strong style="color: #f59e0b;">âš  Medium Unassigned:</strong> 25-50% of work unassigned</li>
                    <li><strong style="color: #ef4444;">â— High Unassigned:</strong> More than 50% of work unassigned</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
