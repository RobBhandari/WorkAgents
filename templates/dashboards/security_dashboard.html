{% extends "dashboards/base_dashboard.html" %}

{% block title %}Security Dashboard{% endblock %}
{% block meta_description %}Security vulnerabilities by product - Director Observatory{% endblock %}

{% block header_title %}Security Vulnerabilities{% endblock %}
{% block header_subtitle %}Product-level vulnerability tracking{% endblock %}
{% block footer_context %}Security Dashboard{% endblock %}

{% block content %}
<!-- Summary cards -->
<div class="section">
    <h2>Overview</h2>
    <div class="summary-grid">
        {% for card in summary_cards %}
        {{ card|safe }}
        {% endfor %}
    </div>
</div>

<!-- Products table -->
<div class="section">
    <h2>Vulnerabilities by Product</h2>
    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Total</th>
                    <th>Critical</th>
                    <th>High</th>
                    <th>Medium</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
            {% for product in products %}
                <tr class="data-row {% if product.expandable %}clickable{% endif %}"
                    {% if product.expandable %}onclick="toggleDetail('detail-{{ loop.index }}', this)"{% endif %}>
                    <td>{{ product.name }}</td>
                    <td>{{ product.total }}</td>
                    <td class="{% if product.critical > 0 %}critical{% endif %}">{{ product.critical }}</td>
                    <td class="{% if product.high > 0 %}high{% endif %}">{{ product.high }}</td>
                    <td>{{ product.medium }}</td>
                    <td>
                        <span class="status-badge status-{{ product.status_class }}">
                            {{ product.status }}
                        </span>
                    </td>
                </tr>
                {% if product.expandable and product.details %}
                <tr id="detail-{{ loop.index }}" class="detail-row">
                    <td colspan="6">
                        <div class="detail-content">
                            {{ product.details|safe }}
                        </div>
                    </td>
                </tr>
                {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Glossary (optional) -->
{% if show_glossary %}
<div class="glossary">
    <div class="glossary-header" onclick="toggleGlossary()">
        <h3>Metric Definitions</h3>
        <span id="glossary-toggle" class="glossary-toggle">â–¼</span>
    </div>
    <div id="glossary-content" class="glossary-content">
        <div class="glossary-item">
            <div class="glossary-term">Critical</div>
            <div class="glossary-definition">
                Vulnerabilities that require immediate attention and can lead to complete system compromise.
            </div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">High</div>
            <div class="glossary-definition">
                Significant vulnerabilities that should be resolved within 30 days.
            </div>
        </div>
        <div class="glossary-item">
            <div class="glossary-term">70% Reduction Target</div>
            <div class="glossary-definition">
                Goal to reduce Critical+High vulnerabilities by 70% from baseline (Jan 1, 2026) by June 30, 2026.
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
