{% extends "dashboards/base_dashboard.html" %}

{% block title %}AI Contributions Dashboard{% endblock %}
{% block meta_description %}AI vs Human contributions tracking - Devin AI analysis{% endblock %}

{% block header_title %}ğŸ¤– AI Contributions Dashboard{% endblock %}
{% block header_subtitle %}Tracking Devin AI vs Human Development Contributions{% endblock %}
{% block footer_context %}AI Contributions Dashboard{% endblock %}

{% block extra_css %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODERN MINIMALIST - Refined Dashboard Styling
   Design Direction: Clean, Refined, Professional
   Inspiration: Stripe, Linear, Modern SaaS dashboards
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

:root {
    --color-slate-50: #f8fafc;
    --color-slate-100: #f1f5f9;
    --color-slate-200: #e2e8f0;
    --color-slate-300: #cbd5e1;
    --color-slate-400: #94a3b8;
    --color-slate-500: #64748b;
    --color-slate-600: #475569;
    --color-slate-700: #334155;
    --color-slate-800: #1e293b;
    --color-slate-900: #0f172a;

    --color-blue-400: #60a5fa;
    --color-blue-500: #3b82f6;
    --color-blue-600: #2563eb;

    --color-emerald-500: #10b981;
    --color-amber-500: #f59e0b;
    --color-red-500: #ef4444;

    --header-gradient-start: var(--color-slate-900) !important;
    --header-gradient-end: var(--color-slate-900) !important;
}

/* Refined typography - Inter with OpenType features */
body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
    background: var(--color-slate-900) !important;
    color: #ffffff !important;
    font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Sophisticated header */
body .header,
.container .header,
div.header {
    background: var(--color-slate-900) !important;
    border: none !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06) !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    padding: 64px 32px !important;
}

.header h1 {
    font-weight: 600 !important;
    letter-spacing: -0.02em !important;
    color: #ffffff !important;
    text-transform: none !important;
    font-size: 2.5rem !important;
}

.header p,
.header .subtitle {
    color: var(--color-slate-400) !important;
    font-weight: 400 !important;
    text-transform: none !important;
    letter-spacing: 0 !important;
}

/* Summary Cards - Refined with subtle borders */
.summary-card,
.card {
    background: var(--color-slate-900) !important;
    border: 1px solid rgba(255, 255, 255, 0.06) !important;
    border-radius: 8px !important;
    padding: 24px !important;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06) !important;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.summary-card:hover,
.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3), 0 8px 10px -6px rgba(0, 0, 0, 0.3) !important;
    border-color: rgba(59, 130, 246, 0.3) !important;
}

/* Tables - Refined styling */
table {
    border-collapse: collapse !important;
}

th {
    background: var(--color-slate-800) !important;
    color: var(--color-slate-400) !important;
    font-weight: 600 !important;
    font-size: 0.85rem !important;
    text-transform: uppercase !important;
    letter-spacing: 0.05em !important;
    padding: 14px 16px !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06) !important;
}

tbody tr {
    border-bottom: 1px solid rgba(255, 255, 255, 0.06) !important;
    transition: background-color 0.2s ease !important;
}

tbody tr:hover {
    background: rgba(255, 255, 255, 0.02) !important;
}

td {
    padding: 12px 16px !important;
    color: #ffffff !important;
}

/* Status badges - Refined colors */
.status-good { color: var(--color-emerald-500) !important; }
.status-caution { color: var(--color-amber-500) !important; }
.status-action { color: var(--color-red-500) !important; }
.status-inactive { color: var(--color-slate-500) !important; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIGHT THEME SUPPORT - Complete styling for light mode
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

[data-theme="light"] body {
    background: #ffffff !important;
    color: var(--color-slate-900) !important;
}

[data-theme="light"] .header {
    background: #ffffff !important;
    border-bottom-color: var(--color-slate-200) !important;
}

[data-theme="light"] .header h1 {
    color: var(--color-slate-900) !important;
}

[data-theme="light"] .header p,
[data-theme="light"] .header .subtitle {
    color: var(--color-slate-600) !important;
}

[data-theme="light"] .summary-card,
[data-theme="light"] .card {
    background: #ffffff !important;
    border-color: var(--color-slate-200) !important;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px 0 rgba(0, 0, 0, 0.03) !important;
}

[data-theme="light"] .summary-card:hover,
[data-theme="light"] .card:hover {
    border-color: var(--color-blue-400) !important;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05) !important;
}

[data-theme="light"] th {
    background: var(--color-slate-100) !important;
    color: var(--color-slate-700) !important;
    border-bottom-color: var(--color-slate-200) !important;
}

[data-theme="light"] tbody tr {
    border-bottom-color: var(--color-slate-200) !important;
}

[data-theme="light"] tbody tr:hover {
    background: var(--color-slate-50) !important;
}

[data-theme="light"] td {
    color: var(--color-slate-900) !important;
}

/* Footer - Light Mode */
[data-theme="light"] .footer p {
    color: var(--color-slate-600) !important;
}
</style>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    // Chart colors based on theme
    function getChartColors() {
        const theme = document.documentElement.getAttribute('data-theme');
        return {
            text: theme === 'dark' ? '#cbd5e1' : '#6b7280',
            grid: theme === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)',
            ai: '#8b5cf6',
            human: '#3b82f6'
        };
    }

    // AI vs Human Pie Chart
    const aiVsHumanCtx = document.getElementById('aiVsHumanChart').getContext('2d');
    let aiVsHumanChart = new Chart(aiVsHumanCtx, {
        type: 'doughnut',
        data: {
            labels: ['Devin AI', 'Human'],
            datasets: [{
                data: [{{ summary_stats.devin_prs }}, {{ summary_stats.human_prs }}],
                backgroundColor: ['#8b5cf6', '#3b82f6'],
                borderWidth: 2,
                borderColor: 'rgba(255, 255, 255, 0.1)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: getChartColors().text,
                        font: { size: 14 }
                    }
                }
            }
        }
    });

    // Top Contributors Bar Chart
    const contributorsCtx = document.getElementById('contributorsChart').getContext('2d');
    let contributorsChart = new Chart(contributorsCtx, {
        type: 'bar',
        data: {
            labels: {{ author_labels|tojson }},
            datasets: [{
                label: 'PRs',
                data: {{ author_counts|tojson }},
                backgroundColor: '#8b5cf6',
                borderColor: '#8b5cf6',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: getChartColors().text },
                    grid: { color: getChartColors().grid }
                },
                x: {
                    ticks: {
                        color: getChartColors().text,
                        autoSkip: false,
                        maxRotation: 45,
                        minRotation: 45
                    },
                    grid: { display: false }
                }
            },
            plugins: {
                legend: { display: false }
            }
        }
    });

    // Projects Chart
    const projectsCtx = document.getElementById('projectsChart').getContext('2d');
    const projectNames = {{ [p.name for p in project_items]|tojson }};
    const projectDevin = {{ [p.devin for p in project_items]|tojson }};
    const projectHuman = {{ [p.human for p in project_items]|tojson }};

    let projectsChart = new Chart(projectsCtx, {
        type: 'bar',
        data: {
            labels: projectNames,
            datasets: [
                {
                    label: 'Devin AI',
                    data: projectDevin,
                    backgroundColor: '#8b5cf6'
                },
                {
                    label: 'Human',
                    data: projectHuman,
                    backgroundColor: '#3b82f6'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    stacked: true,
                    ticks: { color: getChartColors().text },
                    grid: { color: getChartColors().grid }
                },
                x: {
                    stacked: true,
                    ticks: {
                        color: getChartColors().text,
                        autoSkip: false,
                        maxRotation: 45,
                        minRotation: 45
                    },
                    grid: { display: false }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        color: getChartColors().text,
                        font: { size: 14 }
                    }
                }
            }
        }
    });

    // Update charts on theme change
    function updateCharts() {
        const colors = getChartColors();

        [aiVsHumanChart, contributorsChart, projectsChart].forEach(chart => {
            if (chart.options.plugins?.legend) {
                chart.options.plugins.legend.labels.color = colors.text;
            }
            if (chart.options.scales?.y) {
                chart.options.scales.y.ticks.color = colors.text;
                chart.options.scales.y.grid.color = colors.grid;
            }
            if (chart.options.scales?.x) {
                chart.options.scales.x.ticks.color = colors.text;
            }
            chart.update();
        });
    }

    // Hook into theme toggle to update charts
    const originalToggleTheme = window.toggleTheme;
    window.toggleTheme = function() {
        originalToggleTheme();
        updateCharts();
    };
</script>
{% endblock %}

{% block content %}
<!-- Summary Metrics -->
<div class="metrics-grid">
    <div class="metric-card" style="border-left-color: #8b5cf6;">
        <h3>Devin AI PRs</h3>
        <div class="value">{{ summary_stats.devin_prs }}</div>
        <div class="label">{{ summary_stats.devin_percentage|format_percent }}% of total</div>
    </div>

    <div class="metric-card" style="border-left-color: #3b82f6;">
        <h3>Human PRs</h3>
        <div class="value">{{ summary_stats.human_prs }}</div>
        <div class="label">{{ (100 - summary_stats.devin_percentage)|format_percent }}% of total</div>
    </div>

    <div class="metric-card" style="border-left-color: #10b981;">
        <h3>Total PRs</h3>
        <div class="value">{{ summary_stats.total_prs }}</div>
        <div class="label">Last 90 days</div>
    </div>

    <div class="metric-card" style="border-left-color: #f59e0b;">
        <h3>Contributors</h3>
        <div class="value">{{ summary_stats.author_count }}</div>
        <div class="label">Unique authors</div>
    </div>
</div>

<!-- Devin vs Human Chart -->
<div class="chart-section">
    <h2>AI vs Human Contributions</h2>
    <div class="chart-container">
        <canvas id="aiVsHumanChart"></canvas>
    </div>
</div>

<!-- Top Contributors Chart -->
<div class="chart-section">
    <h2>Top Contributors</h2>
    <div class="chart-container">
        <canvas id="contributorsChart"></canvas>
    </div>
</div>

<!-- Project Breakdown Chart -->
<div class="chart-section">
    <h2>Devin Contributions by Project</h2>
    <div class="chart-container">
        <canvas id="projectsChart"></canvas>
    </div>
</div>

<!-- Recent Devin PRs Table -->
<div class="table-container">
    <h2 style="margin-bottom: 20px;">Recent Devin PRs</h2>
    <table>
        <thead>
            <tr>
                <th>PR ID</th>
                <th>Project</th>
                <th>Title</th>
                <th>Author</th>
                <th>Commits</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for pr in recent_prs %}
            <tr>
                <td>#{{ pr.pr_id }}</td>
                <td>{{ pr.project }}</td>
                <td style="max-width: 400px; white-space: normal;">{{ pr.title }}</td>
                <td>{{ pr.created_by }}</td>
                <td>{{ pr.commit_count }}</td>
                <td>{{ pr.created_date }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Data Collection Methodology -->
<div class="methodology-section">
    <h2>ğŸ“Š Data Collection Methodology</h2>
    <p>
        This dashboard analyzes pull request authorship to identify AI-generated vs human-generated contributions.
        The statistics shown are based on the following data collection approach:
    </p>

    <h3>Detection Criteria</h3>
    <p>
        A pull request is classified as "Devin AI" if <strong>any</strong> of the following indicators are present:
    </p>
    <ul>
        <li><strong>Author name</strong> contains "devin" (case-insensitive)
            <br><em style="font-size: 0.9rem; color: var(--text-tertiary);">Example: "Devin Azure DevOps Integration", "Devin AI"</em>
        </li>
        <li><strong>Author email</strong> contains "devin"
            <br><em style="font-size: 0.9rem; color: var(--text-tertiary);">Example: "devin.integration@example.com"</em>
        </li>
        <li><strong>Branch name</strong> contains "devin"
            <br><em style="font-size: 0.9rem; color: var(--text-tertiary);">Example: "refs/heads/devin/1766033274-add-feeearner-email-update-departmentid"</em>
        </li>
        <li><strong>PR title or description</strong> explicitly mentions "Devin"</li>
    </ul>

    <h3>Data Sources</h3>
    <ul>
        <li><strong>Source:</strong> Azure DevOps Git API</li>
        <li><strong>Timeframe:</strong> Last 90 days of completed pull requests</li>
        <li><strong>Scope:</strong> All active projects across the organization</li>
        <li><strong>Limit:</strong> Up to 200 most recent PRs per repository (top 5 repos per project)</li>
    </ul>

    <h3>Known Limitations</h3>
    <ul>
        <li>PRs where Devin initiated work but a human created the PR may be misclassified as "Human"</li>
        <li>Custom Devin configurations with different naming patterns may not be detected</li>
        <li>Historical PRs beyond 90 days are not included in current analysis</li>
        <li>PRs in archived or disabled repositories are excluded</li>
    </ul>

    <h3>Verification Steps</h3>
    <p>To verify these statistics with your teams:</p>
    <ul>
        <li>Cross-reference PR counts with Azure DevOps PR history for specific projects</li>
        <li>Check individual PR authors in Azure DevOps to confirm Devin identification</li>
        <li>Review the "Recent Devin PRs" table above for sample data validation</li>
        <li>Examine branch naming patterns in your repositories for Devin conventions</li>
    </ul>

    <div class="methodology-note">
        <strong>ğŸ“ Note for Team Review:</strong>
        <p>
            These statistics are automatically collected from Azure DevOps. Please review with your teams to ensure
            the Devin detection criteria align with your organization's Devin usage patterns. If you use custom
            Devin configurations or naming conventions, the detection rules may need adjustment.
        </p>
    </div>
</div>
{% endblock %}
